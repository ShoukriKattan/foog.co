var SummaryModule = require("cloud/summary.js");
var Reminders = require('cloud/reminders.js');

exports.summaryJob = function(request, status) {

	// This runs past midnight ... every night ...
	// if this runs midnight ... then it needs to process day before ... or Start day is Today ...

	// End of week = Start of week -1
	// Start of week = end + 1

	// This job wakes up daily, checks day of week

	// Loads all users whose end of week day is set to be same as today
	// For each of them, labels the weeks , and creates end of week summary

	// Set up to modify user data
	Parse.Cloud.useMasterKey();

	SummaryModule.processUsersSummary().then(function() {
		status.success("Summary Run Successfully");
	}, function(error) {
		status.error("Error Running Summary " + JSON.stringify(error));
	});

};

exports.masterJob = function(request, status) {

	var runTime = new Date();

	var runHour = runTime.getHours();

	// At 12 am run Reminder Summary .
	if (runHour == 0) {
		SummaryModule.processUsersSummary().then(function() {
			status.success("Summary Run Successfully");
		}, function(error) {
			status.error("Error Running Summary " + JSON.stringify(error));
		});

	} else {
		// At any other time of day . Run hourly reminders job
		
		
	}

};
